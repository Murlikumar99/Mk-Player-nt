 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Video Player | Local Media Playback</title>
    
    <!-- Performance-Optimized CDNs -->
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- AOS Animation Library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
    
    <!-- Shaka Player -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.9/controls.css">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ¬</text></svg>">
    
    <style>
        /* CSS Reset & Performance Optimization */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #f43f5e;
            --dark-bg: #0f172a;
            --dark-card: #1e293b;
            --dark-card-hover: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --glass-bg: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(148, 163, 184, 0.1);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Reduced motion preference */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Utility Classes */
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: var(--shadow);
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Navbar Styles */
        .navbar {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 1rem 0;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
        }

        .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo-icon {
            color: var(--primary);
            font-size: 2rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
        }

        .nav-link:hover {
            color: var(--text-primary);
        }

        .nav-link.active {
            color: var(--primary);
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary);
            border-radius: 2px;
        }

        /* Main Player Section */
        .main-section {
            padding: 3rem 0;
            min-height: calc(100vh - 200px);
        }

        .player-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        @media (max-width: 1024px) {
            .player-container {
                grid-template-columns: 1fr;
            }
        }

        .video-player-wrapper {
            position: relative;
            overflow: hidden;
            border-radius: 16px;
        }

        #video-container {
            width: 100%;
            height: 500px;
            background: #000;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
        }

        #video-player {
            width: 100%;
            height: 100%;
            display: block;
        }

        .player-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1.5rem;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
            display: flex;
            justify-content: space-between;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #video-container:hover .player-overlay {
            opacity: 1;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            width: 100%;
        }

        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .progress-container {
            flex-grow: 1;
            position: relative;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            cursor: pointer;
        }

        #progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            border-radius: 3px;
            position: absolute;
            top: 0;
            left: 0;
        }

        #buffer-bar {
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
            width: 0%;
            border-radius: 3px;
            position: absolute;
            top: 0;
            left: 0;
        }

        .time-display {
            font-size: 0.9rem;
            color: white;
            white-space: nowrap;
            margin: 0 0.5rem;
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        #volume-slider {
            width: 80px;
            height: 4px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            outline: none;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
        }

        .playback-speed {
            position: relative;
        }

        #speed-select {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            font-size: 0.9rem;
            outline: none;
            cursor: pointer;
        }

        /* Playlist Sidebar */
        .playlist-container {
            padding: 1.5rem;
            height: 500px;
            overflow-y: auto;
        }

        .playlist-container::-webkit-scrollbar {
            width: 6px;
        }

        .playlist-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .playlist-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .playlist-count {
            background: var(--primary);
            color: white;
            font-size: 0.8rem;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
        }

        .video-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .video-card {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            background: var(--dark-card);
        }

        .video-card:hover {
            background: var(--dark-card-hover);
            transform: translateX(5px);
        }

        .video-card.active {
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.2), rgba(99, 102, 241, 0.05));
            border-left: 3px solid var(--primary);
        }

        .video-thumbnail {
            width: 60px;
            height: 40px;
            border-radius: 6px;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .video-thumbnail i {
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        .video-info {
            flex-grow: 1;
            overflow: hidden;
        }

        .video-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .video-details {
            display: flex;
            font-size: 0.8rem;
            color: var(--text-secondary);
            gap: 1rem;
        }

        .video-remove {
            color: var(--error);
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: var(--transition);
        }

        .video-remove:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        /* Upload Section */
        .upload-section {
            padding: 3rem 0;
        }

        .upload-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 3rem;
            text-align: center;
        }

        .upload-icon {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
        }

        .upload-title {
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }

        .upload-description {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .upload-zone {
            border: 2px dashed var(--primary);
            border-radius: 16px;
            padding: 3rem 2rem;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 1.5rem;
        }

        .upload-zone:hover {
            background: rgba(99, 102, 241, 0.05);
            border-color: var(--primary-dark);
        }

        .upload-zone.drag-over {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--primary-dark);
        }

        .upload-button {
            display: inline-block;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1rem;
            margin-top: 1rem;
        }

        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }

        .file-input {
            display: none;
        }

        .supported-formats {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .format-tag {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        /* About Section */
        .about-section {
            padding: 3rem 0;
            background: rgba(0, 0, 0, 0.2);
        }

        .about-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .about-card {
            padding: 2rem;
        }

        .about-card i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
        }

        .about-card h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .about-card p {
            color: var(--text-secondary);
        }

        /* Footer */
        .footer {
            padding: 2rem 0;
            border-top: 1px solid var(--glass-border);
            text-align: center;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .developer-credit {
            font-size: 1.2rem;
            font-weight: 600;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .copyright {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .footer-links {
            display: flex;
            gap: 1.5rem;
            margin-top: 0.5rem;
        }

        .footer-link {
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-link:hover {
            color: var(--primary);
        }

        /* Loading & Error States */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: 16px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .error-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .error-icon {
            font-size: 3rem;
            color: var(--error);
            margin-bottom: 1rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .navbar-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-links {
                gap: 1.5rem;
            }
            
            .player-container {
                gap: 1.5rem;
            }
            
            #video-container {
                height: 400px;
            }
            
            .playlist-container {
                height: 400px;
            }
            
            .upload-container {
                padding: 2rem 1rem;
            }
            
            .upload-zone {
                padding: 2rem 1rem;
            }
            
            .section-title {
                font-size: 1.7rem;
            }
        }

        @media (max-width: 480px) {
            #video-container {
                height: 300px;
            }
            
            .playlist-container {
                height: 350px;
            }
            
            .player-controls {
                flex-wrap: wrap;
                justify-content: center;
                gap: 0.5rem;
            }
            
            .time-display {
                order: 1;
                width: 100%;
                text-align: center;
            }
            
            .progress-container {
                order: 2;
                width: 100%;
            }
            
            .control-btn {
                padding: 0.4rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar" data-aos="fade-down">
        <div class="container navbar-container">
            <div class="logo">
                <i class="fas fa-play-circle logo-icon"></i>
                <span>Nexus Video Player</span>
            </div>
            <div class="nav-links">
                <a href="#player" class="nav-link active">Player</a>
                <a href="#upload" class="nav-link">Upload</a>
                <a href="#about" class="nav-link">About</a>
            </div>
        </div>
    </nav>

    <!-- Main Player Section -->
    <main class="main-section container">
        <div class="player-container">
            <!-- Video Player -->
            <div class="video-player-wrapper glass-card" data-aos="fade-right">
                <div id="video-container">
                    <!-- Video element will be inserted by Shaka Player -->
                    <div class="loading-overlay" id="loading-overlay">
                        <div class="spinner"></div>
                    </div>
                    <div class="error-overlay" id="error-overlay">
                        <i class="fas fa-exclamation-circle error-icon"></i>
                        <h3>Video Playback Error</h3>
                        <p id="error-message">The video could not be loaded. Please try another file.</p>
                        <button class="upload-button" id="retry-button" style="margin-top: 1.5rem;">Try Another Video</button>
                    </div>
                    <div class="player-overlay">
                        <div class="player-controls">
                            <button class="control-btn" id="play-pause-btn" title="Play/Pause">
                                <i class="fas fa-play"></i>
                            </button>
                            <span class="time-display">
                                <span id="current-time">0:00</span> / <span id="duration">0:00</span>
                            </span>
                            <div class="progress-container">
                                <div id="buffer-bar"></div>
                                <div id="progress-bar"></div>
                            </div>
                            <div class="volume-container">
                                <button class="control-btn" id="mute-btn" title="Mute/Unmute">
                                    <i class="fas fa-volume-up"></i>
                                </button>
                                <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1" title="Volume">
                            </div>
                            <div class="playback-speed">
                                <select id="speed-select" title="Playback Speed">
                                    <option value="0.5">0.5x</option>
                                    <option value="0.75">0.75x</option>
                                    <option value="1" selected>1x</option>
                                    <option value="1.25">1.25x</option>
                                    <option value="1.5">1.5x</option>
                                    <option value="2">2x</option>
                                </select>
                            </div>
                            <button class="control-btn" id="fullscreen-btn" title="Fullscreen">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button class="control-btn" id="pip-btn" title="Picture-in-Picture">
                                <i class="fas fa-picture-in-picture"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Playlist Sidebar -->
            <div class="playlist-container glass-card" data-aos="fade-left">
                <div class="playlist-header">
                    <h3>Your Videos</h3>
                    <span class="playlist-count" id="playlist-count">0 videos</span>
                </div>
                <div class="video-list" id="video-list">
                    <div class="empty-state" id="empty-playlist">
                        <i class="fas fa-video-slash"></i>
                        <p>No videos uploaded yet</p>
                        <p>Upload videos to see them here</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upload Section -->
        <section class="upload-section" id="upload" data-aos="zoom-in">
            <h2 class="section-title">Upload Videos</h2>
            <div class="upload-container glass-card">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h2 class="upload-title">Drag & Drop Your Videos</h2>
                <p class="upload-description">
                    Upload local video files to play them instantly in our high-performance player. 
                    Your videos are never uploaded to any server - everything stays on your device.
                </p>
                
                <div class="upload-zone" id="upload-zone">
                    <i class="fas fa-video" style="font-size: 3rem; margin-bottom: 1rem; color: var(--primary);"></i>
                    <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">Drop video files here</p>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">or click to browse</p>
                    <input type="file" class="file-input" id="file-input" accept=".mp4,.mkv,.webm,.mov" multiple>
                    <label for="file-input" class="upload-button">Browse Video Files</label>
                </div>
                
                <div class="supported-formats">
                    <span class="format-tag">MP4</span>
                    <span class="format-tag">MKV</span>
                    <span class="format-tag">WEBM</span>
                    <span class="format-tag">MOV</span>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section class="about-section" id="about" data-aos="fade-up">
            <div class="container">
                <h2 class="section-title">About This Player</h2>
                <div class="about-container">
                    <div class="about-card glass-card">
                        <i class="fas fa-shield-alt"></i>
                        <h3>Privacy First</h3>
                        <p>All videos are processed locally on your device. No data is ever sent to external servers, ensuring complete privacy and security for your media files.</p>
                    </div>
                    <div class="about-card glass-card">
                        <i class="fas fa-tachometer-alt"></i>
                        <h3>High Performance</h3>
                        <p>Built with Shaka Player for smooth playback, AOS for buttery animations, and optimized CDNs for lightning-fast loading - all under 2 seconds.</p>
                    </div>
                    <div class="about-card glass-card">
                        <i class="fas fa-film"></i>
                        <h3>Professional Features</h3>
                        <p>Fullscreen, Picture-in-Picture, playback speed control, keyboard shortcuts, and auto-resume functionality for a premium viewing experience.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer" data-aos="fade-up">
        <div class="container footer-content">
            <div class="developer-credit">Website Developed by Murli Kumar</div>
            <div class="copyright">Â© 2023 Nexus Video Player. All rights reserved.</div>
            <div class="footer-links">
                <a href="#" class="footer-link">Privacy Policy</a>
                <a href="#" class="footer-link">Terms of Service</a>
                <a href="#" class="footer-link">Support</a>
                <a href="#" class="footer-link">GitHub</a>
            </div>
        </div>
    </footer>

    <!-- JavaScript CDNs -->
    <!-- AOS Animation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    
    <!-- Shaka Player -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.9/shaka-player.ui.js"></script>
    
    <!-- Main Application Script -->
    <script>
        // Initialize AOS animations
        AOS.init({
            duration: 800,
            easing: 'ease-out-quad',
            once: true,
            offset: 50,
            disable: window.matchMedia('(prefers-reduced-motion: reduce)').matches
        });

        // DOM Elements
        const videoContainer = document.getElementById('video-container');
        const videoList = document.getElementById('video-list');
        const playlistCount = document.getElementById('playlist-count');
        const uploadZone = document.getElementById('upload-zone');
        const fileInput = document.getElementById('file-input');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const muteBtn = document.getElementById('mute-btn');
        const volumeSlider = document.getElementById('volume-slider');
        const speedSelect = document.getElementById('speed-select');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const pipBtn = document.getElementById('pip-btn');
        const progressBar = document.getElementById('progress-bar');
        const bufferBar = document.getElementById('buffer-bar');
        const progressContainer = document.querySelector('.progress-container');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');
        const loadingOverlay = document.getElementById('loading-overlay');
        const errorOverlay = document.getElementById('error-overlay');
        const errorMessage = document.getElementById('error-message');
        const retryButton = document.getElementById('retry-button');
        const emptyPlaylist = document.getElementById('empty-playlist');

        // Application State
        let player = null;
        let ui = null;
        let currentVideoIndex = -1;
        let videos = JSON.parse(localStorage.getItem('nexus_videos') || '[]');
        let lastPlayedVideoId = localStorage.getItem('nexus_last_played');

        // Initialize Shaka Player
        function initPlayer() {
            // Check if Shaka Player is supported
            if (!shaka.Player.isBrowserSupported()) {
                showError('Your browser does not support Shaka Player. Please try a modern browser like Chrome, Firefox, or Edge.');
                return;
            }

            // Create player instance
            const videoElement = document.createElement('video');
            videoElement.id = 'video-player';
            videoElement.setAttribute('playsinline', '');
            videoContainer.prepend(videoElement);

            player = new shaka.Player(videoElement);
            ui = new shaka.ui.Overlay(player, videoContainer, videoElement);

            // Configure player
            player.configure({
                streaming: {
                    bufferingGoal: 30,
                    rebufferingGoal: 2,
                    bufferBehind: 30,
                    ignoreTextStreamFailures: true
                },
                manifest: {
                    dash: {
                        ignoreMinBufferTime: true
                    }
                }
            });

            // Set up UI controls
            const controls = ui.getControls();
            
            // Listen for player events
            player.addEventListener('loading', () => {
                loadingOverlay.classList.add('active');
            });

            player.addEventListener('loaded', () => {
                loadingOverlay.classList.remove('active');
                errorOverlay.classList.remove('active');
                updatePlayPauseButton();
                updateDurationDisplay();
                
                // Save playback position
                const currentVideo = videos[currentVideoIndex];
                if (currentVideo) {
                    localStorage.setItem(`nexus_pos_${currentVideo.id}`, videoElement.currentTime.toString());
                }
            });

            player.addEventListener('error', (error) => {
                console.error('Player error:', error);
                loadingOverlay.classList.remove('active');
                showError('Failed to play video. The file may be corrupted or in an unsupported format.');
            });

            videoElement.addEventListener('timeupdate', updateProgress);
            videoElement.addEventListener('loadedmetadata', updateDurationDisplay);
            videoElement.addEventListener('play', updatePlayPauseButton);
            videoElement.addEventListener('pause', updatePlayPauseButton);
            videoElement.addEventListener('volumechange', updateVolumeControls);
            videoElement.addEventListener('enterpictureinpicture', updatePipButton);
            videoElement.addEventListener('leavepictureinpicture', updatePipButton);
            
            // Initialize controls
            playPauseBtn.addEventListener('click', togglePlayPause);
            muteBtn.addEventListener('click', toggleMute);
            volumeSlider.addEventListener('input', updateVolume);
            speedSelect.addEventListener('change', updatePlaybackSpeed);
            fullscreenBtn.addEventListener('click', toggleFullscreen);
            pipBtn.addEventListener('click', togglePictureInPicture);
            progressContainer.addEventListener('click', seekVideo);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
            
            // Restore last played video if available
            if (lastPlayedVideoId && videos.length > 0) {
                const lastPlayedIndex = videos.findIndex(v => v.id === lastPlayedVideoId);
                if (lastPlayedIndex !== -1) {
                    setTimeout(() => loadVideo(lastPlayedIndex), 500);
                }
            }
            
            // Update playlist display
            updatePlaylist();
        }

        // Video Playlist Management
        function updatePlaylist() {
            videoList.innerHTML = '';
            
            if (videos.length === 0) {
                emptyPlaylist.style.display = 'block';
                playlistCount.textContent = '0 videos';
                return;
            }
            
            emptyPlaylist.style.display = 'none';
            playlistCount.textContent = `${videos.length} ${videos.length === 1 ? 'video' : 'videos'}`;
            
            videos.forEach((video, index) => {
                const videoCard = document.createElement('div');
                videoCard.className = `video-card ${index === currentVideoIndex ? 'active' : ''}`;
                videoCard.dataset.index = index;
                
                const formattedSize = formatFileSize(video.size);
                
                videoCard.innerHTML = `
                    <div class="video-thumbnail">
                        <i class="fas fa-film"></i>
                    </div>
                    <div class="video-info">
                        <div class="video-title" title="${video.name}">${video.name}</div>
                        <div class="video-details">
                            <span>${formattedSize}</span>
                            <span>${video.format.toUpperCase()}</span>
                        </div>
                    </div>
                    <button class="video-remove" title="Remove video">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                videoCard.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('video-remove') && 
                        !e.target.parentElement.classList.contains('video-remove')) {
                        loadVideo(index);
                    }
                });
                
                const removeBtn = videoCard.querySelector('.video-remove');
                removeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    removeVideo(index);
                });
                
                videoList.appendChild(videoCard);
            });
            
            // Save to localStorage
            localStorage.setItem('nexus_videos', JSON.stringify(videos));
        }

        function addVideo(file) {
            // Validate file type
            const validExtensions = ['.mp4', '.mkv', '.webm', '.mov'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!validExtensions.includes(fileExtension)) {
                showError(`Unsupported file format: ${fileExtension}. Please upload MP4, MKV, WEBM, or MOV files.`);
                return;
            }
            
            // Create video object
            const video = {
                id: 'video_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                name: file.name,
                size: file.size,
                format: fileExtension.substring(1),
                file: file,
                url: URL.createObjectURL(file),
                added: new Date().toISOString()
            };
            
            videos.push(video);
            
            // If this is the first video, load it
            if (videos.length === 1) {
                loadVideo(0);
            }
            
            updatePlaylist();
            
            // Show success feedback
            showUploadFeedback(`"${file.name}" added successfully!`);
        }

        function loadVideo(index) {
            if (index < 0 || index >= videos.length) return;
            
            currentVideoIndex = index;
            const video = videos[index];
            
            // Save last played video
            localStorage.setItem('nexus_last_played', video.id);
            
            // Load video with Shaka Player
            loadingOverlay.classList.add('active');
            
            // Clean up previous video URL
            if (player && player.getAssetUri()) {
                const prevUrl = player.getAssetUri();
                if (prevUrl && prevUrl.startsWith('blob:')) {
                    URL.revokeObjectURL(prevUrl);
                }
            }
            
            // Load the new video
            player.load(video.url).then(() => {
                // Restore playback position if available
                const savedPosition = localStorage.getItem(`nexus_pos_${video.id}`);
                if (savedPosition) {
                    player.getMediaElement().currentTime = parseFloat(savedPosition);
                }
                
                updatePlaylist();
            }).catch((error) => {
                console.error('Error loading video:', error);
                showError('Failed to load video. The file may be corrupted or in an unsupported format.');
            });
        }

        function removeVideo(index) {
            // Clean up URL
            if (videos[index].url && videos[index].url.startsWith('blob:')) {
                URL.revokeObjectURL(videos[index].url);
            }
            
            // Remove from array
            videos.splice(index, 1);
            
            // Adjust current video index
            if (currentVideoIndex === index) {
                currentVideoIndex = -1;
                if (videos.length > 0) {
                    loadVideo(0);
                } else {
                    // No videos left, clear player
                    if (player) {
                        player.unload();
                        currentTimeEl.textContent = '0:00';
                        durationEl.textContent = '0:00';
                        progressBar.style.width = '0%';
                        bufferBar.style.width = '0%';
                        updatePlayPauseButton();
                    }
                }
            } else if (currentVideoIndex > index) {
                currentVideoIndex--;
            }
            
            updatePlaylist();
        }

        // Player Controls
        function togglePlayPause() {
            const videoElement = player.getMediaElement();
            if (videoElement.paused) {
                videoElement.play();
            } else {
                videoElement.pause();
            }
            updatePlayPauseButton();
        }

        function updatePlayPauseButton() {
            const videoElement = player.getMediaElement();
            const icon = playPauseBtn.querySelector('i');
            if (videoElement.paused) {
                icon.className = 'fas fa-play';
                playPauseBtn.setAttribute('title', 'Play');
            } else {
                icon.className = 'fas fa-pause';
                playPauseBtn.setAttribute('title', 'Pause');
            }
        }

        function toggleMute() {
            const videoElement = player.getMediaElement();
            videoElement.muted = !videoElement.muted;
            updateVolumeControls();
        }

        function updateVolumeControls() {
            const videoElement = player.getMediaElement();
            const icon = muteBtn.querySelector('i');
            
            if (videoElement.muted || videoElement.volume === 0) {
                icon.className = 'fas fa-volume-mute';
                muteBtn.setAttribute('title', 'Unmute');
                volumeSlider.value = 0;
            } else {
                if (videoElement.volume < 0.5) {
                    icon.className = 'fas fa-volume-down';
                } else {
                    icon.className = 'fas fa-volume-up';
                }
                muteBtn.setAttribute('title', 'Mute');
                volumeSlider.value = videoElement.volume;
            }
        }

        function updateVolume() {
            const videoElement = player.getMediaElement();
            videoElement.volume = volumeSlider.value;
            videoElement.muted = volumeSlider.value === 0;
            updateVolumeControls();
        }

        function updatePlaybackSpeed() {
            const videoElement = player.getMediaElement();
            videoElement.playbackRate = parseFloat(speedSelect.value);
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                videoContainer.requestFullscreen().catch(err => {
                    console.error(`Error attempting to enable fullscreen: ${err.message}`);
                });
                fullscreenBtn.querySelector('i').className = 'fas fa-compress';
                fullscreenBtn.setAttribute('title', 'Exit Fullscreen');
            } else {
                document.exitFullscreen();
                fullscreenBtn.querySelector('i').className = 'fas fa-expand';
                fullscreenBtn.setAttribute('title', 'Fullscreen');
            }
        }

        function togglePictureInPicture() {
            const videoElement = player.getMediaElement();
            if (document.pictureInPictureElement) {
                document.exitPictureInPicture();
            } else {
                videoElement.requestPictureInPicture();
            }
        }

        function updatePipButton() {
            const icon = pipBtn.querySelector('i');
            if (document.pictureInPictureElement) {
                icon.className = 'fas fa-times-circle';
                pipBtn.setAttribute('title', 'Exit Picture-in-Picture');
            } else {
                icon.className = 'fas fa-picture-in-picture';
                pipBtn.setAttribute('title', 'Picture-in-Picture');
            }
        }

        function updateProgress() {
            const videoElement = player.getMediaElement();
            const percent = (videoElement.currentTime / videoElement.duration) * 100;
            progressBar.style.width = `${percent}%`;
            
            // Update buffer bar
            if (videoElement.buffered.length > 0) {
                const bufferedEnd = videoElement.buffered.end(videoElement.buffered.length - 1);
                const bufferPercent = (bufferedEnd / videoElement.duration) * 100;
                bufferBar.style.width = `${bufferPercent}%`;
            }
            
            // Update time display
            currentTimeEl.textContent = formatTime(videoElement.currentTime);
        }

        function seekVideo(e) {
            const videoElement = player.getMediaElement();
            const rect = progressContainer.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            videoElement.currentTime = percent * videoElement.duration;
        }

        function updateDurationDisplay() {
            const videoElement = player.getMediaElement();
            if (videoElement.duration) {
                durationEl.textContent = formatTime(videoElement.duration);
            }
        }

        // Helper Functions
        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            
            if (h > 0) {
                return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            } else {
                return `${m}:${s.toString().padStart(2, '0')}`;
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorOverlay.classList.add('active');
        }

        function showUploadFeedback(message) {
            // Create feedback element
            const feedback = document.createElement('div');
            feedback.className = 'upload-feedback glass-card';
            feedback.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                background: var(--success);
                color: white;
                border-radius: 8px;
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
                box-shadow: var(--shadow);
            `;
            
            feedback.innerHTML = `
                <i class="fas fa-check-circle" style="margin-right: 0.5rem;"></i>
                ${message}
            `;
            
            document.body.appendChild(feedback);
            
            // Remove after 3 seconds
            setTimeout(() => {
                feedback.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => feedback.remove(), 300);
            }, 3000);
            
            // Add CSS animations
            if (!document.querySelector('#feedback-styles')) {
                const style = document.createElement('style');
                style.id = 'feedback-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Keyboard Shortcuts
        function handleKeyboardShortcuts(e) {
            // Don't trigger if user is typing in an input
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT' || e.target.tagName === 'TEXTAREA') {
                return;
            }
            
            const videoElement = player.getMediaElement();
            
            switch(e.key.toLowerCase()) {
                case ' ':
                case 'k':
                    e.preventDefault();
                    togglePlayPause();
                    break;
                case 'f':
                    if (e.ctrlKey || e.metaKey) return; // Allow browser find shortcut
                    e.preventDefault();
                    toggleFullscreen();
                    break;
                case 'm':
                    e.preventDefault();
                    toggleMute();
                    break;
                case 'arrowleft':
                    e.preventDefault();
                    videoElement.currentTime = Math.max(0, videoElement.currentTime - 10);
                    break;
                case 'arrowright':
                    e.preventDefault();
                    videoElement.currentTime = Math.min(videoElement.duration, videoElement.currentTime + 10);
                    break;
                case 'arrowup':
                    e.preventDefault();
                    videoElement.volume = Math.min(1, videoElement.volume + 0.1);
                    updateVolumeControls();
                    break;
                case 'arrowdown':
                    e.preventDefault();
                    videoElement.volume = Math.max(0, videoElement.volume - 0.1);
                    updateVolumeControls();
                    break;
                case 'j':
                    e.preventDefault();
                    videoElement.currentTime = Math.max(0, videoElement.currentTime - 10);
                    break;
                case 'l':
                    e.preventDefault();
                    videoElement.currentTime = Math.min(videoElement.duration, videoElement.currentTime + 10);
                    break;
                case '0':
                case '1':
                case '2':
                case '3':
                case '4':
                case '5':
                case '6':
                case '7':
                case '8':
                case '9':
                    if (!e.ctrlKey && !e.metaKey) {
                        e.preventDefault();
                        const percent = parseInt(e.key) / 10;
                        videoElement.currentTime = videoElement.duration * percent;
                    }
                    break;
            }
        }

        // File Upload Handling
        function handleFileUpload(files) {
            let validFiles = 0;
            
            for (let file of files) {
                // Check if file is a video
                if (file.type.startsWith('video/')) {
                    addVideo(file);
                    validFiles++;
                }
            }
            
            if (validFiles === 0 && files.length > 0) {
                showError('No valid video files found. Please upload MP4, MKV, WEBM, or MOV files.');
            }
        }

        // Event Listeners for Upload
        uploadZone.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            handleFileUpload(Array.from(e.target.files));
            fileInput.value = ''; // Reset input
        });

        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('drag-over');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('drag-over');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('drag-over');
            
            if (e.dataTransfer.files.length) {
                handleFileUpload(Array.from(e.dataTransfer.files));
            }
        });

        retryButton.addEventListener('click', () => {
            errorOverlay.classList.remove('active');
            fileInput.click();
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    // Update active nav link
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Scroll to target
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initPlayer();
            
            // Auto-hide controls after inactivity
            let controlsTimeout;
            const videoWrapper = document.querySelector('.video-player-wrapper');
            
            const resetControlsTimer = () => {
                clearTimeout(controlsTimeout);
                controlsTimeout = setTimeout(() => {
                    const overlay = document.querySelector('.player-overlay');
                    if (overlay && !player.getMediaElement().paused) {
                        overlay.style.opacity = '0';
                    }
                }, 3000);
            };
            
            videoWrapper.addEventListener('mousemove', () => {
                const overlay = document.querySelector('.player-overlay');
                if (overlay) {
                    overlay.style.opacity = '1';
                    resetControlsTimer();
                }
            });
            
            videoWrapper.addEventListener('mouseleave', () => {
                const overlay = document.querySelector('.player-overlay');
                if (overlay && !player.getMediaElement().paused) {
                    overlay.style.opacity = '0';
                }
            });
            
            resetControlsTimer();
            
            // Update nav link on scroll
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');
            
            const updateActiveNavLink = () => {
                let current = '';
                const scrollPos = window.scrollY + 100;
                
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.clientHeight;
                    
                    if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
                        current = section.getAttribute('id');
                    }
                });
                
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${current}`) {
                        link.classList.add('active');
                    }
                });
            };
            
            window.addEventListener('scroll', updateActiveNavLink);
        });

        // Handle page visibility change (auto-pause when tab is hidden)
        document.addEventListener('visibilitychange', () => {
            const videoElement = player?.getMediaElement();
            if (videoElement) {
                if (document.hidden) {
                    // Save playback position when tab is hidden
                    const currentVideo = videos[currentVideoIndex];
                    if (currentVideo) {
                        localStorage.setItem(`nexus_pos_${currentVideo.id}`, videoElement.currentTime.toString());
                    }
                }
            }
        });
    </script>
</body>
</html>